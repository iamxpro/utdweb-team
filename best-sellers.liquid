{{ 'section-best-sellers.css' | asset_url | preload_tag: as: 'style' }}
{{ 'section-best-sellers.css' | asset_url | stylesheet_tag }}
{{ 'section-best-sellers.js' | asset_url | preload_tag: as: 'script' }}
<script src="{{ 'section-best-sellers.js' | asset_url }}" defer="defer"></script>

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<div class="best-sellers section-{{ section.id }}-padding" data-section-id="{{ section.id }}">
  <div class="best-sellers__container">

    {% if section.blocks.size > 0 %}
      <div class="best-sellers__content">
        <div class="best-sellers__nav">
          {% if section.settings.section_label != blank or section.settings.title != blank %}
            <div class="best-sellers__header">
              {% if section.settings.section_label != blank %}
                <div class="best-sellers__label">{{ section.settings.section_label }}</div>
              {% endif %}
              {% if section.settings.title != blank %}
                <h2 class="best-sellers__title">{{ section.settings.title }}</h2>
              {% endif %}
            </div>
          {% endif %}

          {% for block in section.blocks %}
            {% assign collection = block.settings.collection %}
            {% assign collection_title = block.settings.collection_title | default: collection.title %}

            {% if collection_title != blank %}
              {% assign display_title = collection_title %}
            {% else %}
              {% assign display_title = 'Collection ' | append: forloop.index %}
            {% endif %}

            <div
              class="best-sellers__nav-item {% if forloop.first %}active{% endif %}"
              data-block-id="{{ block.id }}"
              {{ block.shopify_attributes }}>
              {{ display_title }}{{- 'icon-arrow.svg' | inline_asset_content -}}</div>
          {% endfor %}
        </div>

        <div class="best-sellers__products">
          {% for block in section.blocks %}
            {% assign collection = block.settings.collection | default: collections['frontpage'] %}
            {% assign product = block.settings.product | default: collection.products.first %}

            {% if product == null or product == blank %}
              {% assign product = collections.all.products.first %}
            {% endif %}

            <div
              class="best-sellers__product {% if forloop.first %}active{% endif %}"
              data-block-id="{{ block.id }}"
              data-product-id="{% if product %}{{ product.id }}{% endif %}">
              {% if product %}
                <div class="best-sellers__product-inner">
                  <div class="best-sellers__product-image-wrapper">
                    <a href="{{ product.url }}">
                      {% if product.featured_image %}
                        <picture>
                          <source
                            media="(max-width: 749px)"
                            sizes="(max-width: 749px) 100vw, 400px"
                            srcset="{{ product.featured_image | image_url: width: 400 }} 1x, {{ product.featured_image | image_url: width: 800 }} 2x">
                          <source
                            media="(min-width: 750px)"
                            sizes="(min-width: 750px) 50vw, 800px"
                            srcset="{{ product.featured_image | image_url: width: 800 }} 1x, {{ product.featured_image | image_url: width: 1600 }} 2x">
                          <img
                            src="{{ product.featured_image | image_url: width: 800 }}"
                            srcset="{{ product.featured_image | image_url: 800 }} 1x, {{ product.featured_image | image_url: 1600 }} 2x"
                            sizes="100vw"
                            alt="{{ product.featured_image.alt | default: product.title | escape }}"
                            class="best-sellers__product-image"
                            loading="lazy"
                            fetchpriority="high"
                            width="{{ product.featured_image.width | default: 800 }}"
                            height="{{ product.featured_image.height | default: 800 }}">
                        </picture>
                      {% else %}
                        <div class="best-sellers__product-placeholder">
                          {{ 'product-1' | placeholder_svg_tag }}
                        </div>
                      {% endif %}
                    </a>

                    {% if product.tags.size > 0 %}
                      <div class="best-sellers__product-tags">
                        {% assign tag_count = 0 %}
                        {% for tag in product.tags %}
                          {% if tag_count < 3 %}
                            <span class="best-sellers__product-tag {% if tag == 'Sale' %}best-sellers__product-tag--sale{% endif %}">
                              {{ tag }}
                            </span>
                            {% assign tag_count = tag_count | plus: 1 %}
                          {% endif %}
                        {% endfor %}
                      </div>
                    {% endif %}

                    <div class="best-sellers__product-actions">
                      <button
                        type="button"
                        class="best-sellers__product-action-btn best-sellers__wishlist-btn"
                        data-product-name="{{ product.title | escape }}"
                        aria-label="Add to wishlist">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor">
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                      </button>
                      <button
                        type="button"
                        class="best-sellers__product-action-btn best-sellers__add-to-cart-btn"
                        data-variant-id="{% if product.selected_or_first_available_variant %}{{ product.selected_or_first_available_variant.id }}{% endif %}"
                        {% unless product.available %}
                        disabled{% endunless %}
                        aria-label="Add to cart">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor">
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                      </button>
                    </div>
                  </div>

                  <div class="best-sellers__product-info">
                    <h3 class="best-sellers__product-title">
                      <a href="{{ product.url }}">{{ product.title }}</a>
                    </h3>
                    <div class="best-sellers__product-price">
                      {%- liquid
                        assign target = product.selected_or_first_available_variant
                        if target == nil or target == blank
                          assign target = product
                        endif
                        assign compare_at_price = target.compare_at_price
                        assign price = target.price | default: 1999
                      -%}
                      <div class="price {% if compare_at_price %} price--on-sale{% endif %}">
                        <span class="price-item price-item--regular">
                          {% if settings.currency_code_enabled %}
                            {{ price | money_with_currency }}
                          {% else %}
                            {{ price | money }}
                          {% endif %}
                        </span>
                        {% if compare_at_price and compare_at_price > price %}
                          <span class="price-item price-item--sale">
                            {% if settings.currency_code_enabled %}
                              {{ compare_at_price | money_with_currency }}
                            {% else %}
                              {{ compare_at_price | money }}
                            {% endif %}
                          </span>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              {% else %}
                <div class="best-sellers__product-inner">
                  <p>Please select a collection or product.</p>
                </div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </div>
</div>

<!-- Modal -->
<div class="best-sellers-modal" data-modal-id="{{ section.id }}">
  <div class="best-sellers-modal__overlay"></div>
  <div class="best-sellers-modal__content">
    <button
      type="button"
      class="best-sellers-modal__close"
      aria-label="Close">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
    <p class="best-sellers-modal__text"></p>
  </div>
</div>

{% schema %}
  {
    "name": "Best Sellers",
    "tag": "section",
    "class": "section section-best-sellers",
    "disabled_on": {
      "groups": ["header", "footer"]
    },
    "settings": [
      {
        "type": "text",
        "id": "section_label",
        "label": "Section label",
        "default": "Best sellers"
      },
      {
        "type": "text",
        "id": "title",
        "label": "Title",
        "default": "Trending Products"
      },
      {
        "type": "header",
        "content": "Spacing"
      },
      {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "Padding top",
        "default": 40
      },
      {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "Padding bottom",
        "default": 40
      }
    ],
    "blocks": [
      {
        "type": "collection",
        "name": "Collection",
        "limit": 3,
        "settings": [
          {
            "type": "collection",
            "id": "collection",
            "label": "Collection"
          },
          {
            "type": "text",
            "id": "collection_title",
            "label": "Collection title",
            "info": "Override collection name"
          },
          {
            "type": "product",
            "id": "product",
            "label": "Product",
            "info": "Override first product from collection"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Best Sellers",
        "blocks": [
          {
            "type": "collection"
          }
        ]
      }
    ]
  }
{% endschema %}